<nav
  class="bg-base-100 sticky top-0 z-50 transition-shadow duration-300"
  [class.shadow-sm]="isScrolled"
  aria-label="Navigation principale"
>
  <div class="w-full px-4 md:px-8 lg:px-24 xl:px-48 2xl:px-64">
    <div class="navbar px-0 max-w-[1500px] mx-auto">
      <div class="navbar-start">
        <a routerLink="/" class="cursor-pointer" title="Accueil - Sortir">
          <img
            src="assets/logos/sortir_logo.webp"
            alt="Logo Sortir - Retour à l'accueil"
            class="h-8 w-auto hover:opacity-80 transition-opacity"
          />
        </a>
      </div>

      <div class="navbar-center"></div>

      <div class="navbar-end">
        @if (!(isAuthenticated$ | async)) {
        <button
          class="btn btn-primary hidden xl:flex"
          (click)="openAuthModal()"
          aria-label="Se connecter"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"
            />
          </svg>
          <span>Se connecter</span>
        </button>
        } @if (isAuthenticated$ | async) {
        <div class="hidden xl:flex items-center gap-2">
          <div class="dropdown dropdown-end">
            <div
              tabindex="0"
              role="button"
              class="cursor-pointer"
              aria-label="Menu utilisateur"
            >
              <div class="avatar placeholder">
                <div
                  class="w-10 rounded-xl bg-white flex items-center justify-center hover:bg-base-200 transition-colors"
                >
                  <span class="text-sm font-bold text-primary">{{
                    (currentUser$ | async)?.username?.charAt(0)?.toUpperCase()
                  }}</span>
                </div>
              </div>
            </div>
            <ul
              tabindex="0"
              role="menu"
              aria-label="Menu utilisateur"
              class="menu dropdown-content mt-3 z-[1] p-4 shadow bg-base-100 rounded-box w-52 border border-base-200"
            >
              <li role="none">
                <a class="flex items-center gap-2" role="menuitem" routerLink="/profile">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                    />
                  </svg>
                  Profil
                </a>
              </li>
              <div class="divider my-1"></div>
              <li role="none">
                <button
                  type="button"
                  role="menuitem"
                  class="flex items-center gap-2 text-error w-full text-left"
                  (click)="logout()"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                    />
                  </svg>
                  Déconnexion
                </button>
              </li>
            </ul>
          </div>
        </div>
        }

        <div class="dropdown dropdown-end xl:hidden">
          <div
            tabindex="0"
            role="button"
            class="btn btn-square btn-ghost"
            title="Menu de navigation"
            aria-label="Ouvrir le menu de navigation"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              />
            </svg>
          </div>
          <ul
            tabindex="0"
            role="menu"
            aria-label="Menu de navigation mobile"
            class="menu dropdown-content mt-3 z-[1] p-4 shadow bg-base-100 rounded-box w-80 border border-base-200"
          >
            @if (!(isAuthenticated$ | async)) {
            <li>
              <button
                type="button"
                class="btn btn-primary btn-sm w-full"
                (click)="openAuthModal()"
                aria-label="Se connecter"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"
                  />
                </svg>
                Se connecter
              </button>
            </li>

            <div class="divider my-2"></div>

            <li>
              <button
                type="button"
                class="flex items-center gap-2 justify-between w-full text-left"
                (click)="toggleHistoryDropdown()"
                aria-label="Afficher/masquer l'historique"
                [attr.aria-expanded]="showHistoryDropdown"
              >
                <div class="flex items-center gap-2">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                  <span>Historique</span>
                </div>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4 transition-transform"
                  [class.rotate-180]="showHistoryDropdown"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"
                  />
                </svg>
              </button>
            </li>
            @if (showHistoryDropdown) { @for (event of historyEvents(); track
            event.ticketmasterId) {
            <li>
              <button
                (click)="navigateToEvent(event)"
                class="btn btn-ghost w-full justify-start p-3 h-auto min-h-0 border-0 focus:border-0 hover:border-0 text-left"
                [attr.title]="
                  'Retourner sur l\'événement ' + getEventTitle(event)
                "
                type="button"
              >
                <div class="flex items-start gap-3 w-full">
                  @if (getEventImage(event)) {
                  <div class="avatar flex-shrink-0">
                    <div class="w-10 h-10 rounded">
                      <img
                        [src]="getEventImage(event)"
                        [alt]="'Image de l\'événement ' + getEventTitle(event)"
                        class="object-cover"
                      />
                    </div>
                  </div>
                  } @else {
                  <div class="avatar placeholder flex-shrink-0">
                    <div
                      class="bg-neutral text-neutral-content rounded w-10 h-10"
                    >
                      <span class="text-xs">
                        {{ getEventTitle(event).charAt(0).toUpperCase() }}
                      </span>
                    </div>
                  </div>
                  }

                  <div class="flex-1 min-w-0 space-y-1">
                    <span
                      class="font-semibold text-sm text-base-content truncate block"
                    >
                      {{ truncateText(getEventTitle(event), 25) }}
                    </span>
                    <span class="text-xs text-base-content/80 truncate block">
                      {{ truncateText(getEventLocation(event), 30) }}
                    </span>
                    <span class="text-xs text-base-content/80 block">
                      {{ formatDate(event) }}
                    </span>
                  </div>
                </div>
              </button>
            </li>
            } }
            } @if (isAuthenticated$ | async) {
            <div class="flex justify-center py-4 pointer-events-none">
              <div class="avatar placeholder">
                <div
                  class="w-16 rounded-xl bg-white flex items-center justify-center"
                >
                  <span class="text-2xl font-bold text-primary">
                    {{
                      (currentUser$ | async)?.username?.charAt(0)?.toUpperCase()
                    }}
                  </span>
                </div>
              </div>
            </div>

            <li>
              <a class="flex items-center gap-2" routerLink="/profile">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                  />
                </svg>
                Profil
              </a>
            </li>

            <li>
              <button
                type="button"
                class="flex items-center gap-2 text-error w-full text-left"
                (click)="logout()"
                aria-label="Se déconnecter"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                  />
                </svg>
                Déconnexion
              </button>
            </li>

            <div class="divider my-2"></div>

            <li>
              <button
                type="button"
                class="flex items-center gap-2 justify-between w-full text-left"
                (click)="toggleHistoryDropdown()"
                aria-label="Afficher/masquer l'historique"
                [attr.aria-expanded]="showHistoryDropdown"
              >
                <div class="flex items-center gap-2">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                  <span>Historique</span>
                </div>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4 transition-transform"
                  [class.rotate-180]="showHistoryDropdown"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"
                  />
                </svg>
              </button>
            </li>
            @if (showHistoryDropdown) { @for (event of historyEvents(); track
            event.ticketmasterId) {
            <li>
              <button
                (click)="navigateToEvent(event)"
                class="btn btn-ghost w-full justify-start p-3 h-auto min-h-0 border-0 focus:border-0 hover:border-0 text-left"
                [attr.title]="
                  'Retourner sur l\'événement ' + getEventTitle(event)
                "
                type="button"
              >
                <div class="flex items-start gap-3 w-full">
                  @if (getEventImage(event)) {
                  <div class="avatar flex-shrink-0">
                    <div class="w-10 h-10 rounded">
                      <img
                        [src]="getEventImage(event)"
                        [alt]="'Image de l\'événement ' + getEventTitle(event)"
                        class="object-cover"
                      />
                    </div>
                  </div>
                  } @else {
                  <div class="avatar placeholder flex-shrink-0">
                    <div
                      class="bg-neutral text-neutral-content rounded w-10 h-10"
                    >
                      <span class="text-xs">
                        {{ getEventTitle(event).charAt(0).toUpperCase() }}
                      </span>
                    </div>
                  </div>
                  }

                  <div class="flex-1 min-w-0 space-y-1">
                    <span
                      class="font-semibold text-sm text-base-content truncate block"
                    >
                      {{ truncateText(getEventTitle(event), 25) }}
                    </span>
                    <span class="text-xs text-base-content/80 truncate block">
                      {{ truncateText(getEventLocation(event), 30) }}
                    </span>
                    <span class="text-xs text-base-content/80 block">
                      {{ formatDate(event) }}
                    </span>
                  </div>
                </div>
              </button>
            </li>
            } } }
          </ul>
        </div>
      </div>
    </div>
  </div>
</nav>

<app-auth [isOpen]="isAuthModalOpen" (close)="closeAuthModal()"> </app-auth>
