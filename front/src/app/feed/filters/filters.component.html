<!-- Accordéon principal des filtres -->
<div class="collapse collapse-arrow mb-6 rounded-lg">
  <input
    type="checkbox"
    class="collapse-toggle"
    [checked]="mainFiltersAccordionOpen()"
    (change)="toggleMainFiltersAccordion()"
  />
  <div class="collapse-title hover:bg-base-200 rounded-lg cursor-pointer">
    <h2 class="text-lg font-semibold flex items-center gap-2">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-5 w-5 text-primary"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
        />
      </svg>
      Filtrer les événements @if (getSelectedSegmentCount() > 0 ||
      getSelectedGenreCount() > 0) {
      <span class="badge badge-primary badge-sm">{{
        getSelectedSegmentCount() + getSelectedGenreCount()
      }}</span>
      }
    </h2>
  </div>
  <div class="collapse-content">
    <!-- Sous-accordéon des filtres par catégorie -->
    <div class="collapse collapse-arrow mb-4 rounded-lg ml-4">
      <input
        type="checkbox"
        class="collapse-toggle"
        [checked]="segmentAccordionOpen()"
        (change)="toggleSegmentAccordion()"
      />
      <div
        class="collapse-title hover:bg-base-200 rounded-lg cursor-pointer py-2"
      >
        <h3 class="text-md font-medium">
          Catégories @if (getSelectedSegmentCount() > 0) {
          <span class="badge badge-primary badge-sm">{{
            getSelectedSegmentCount()
          }}</span>
          }
        </h3>
      </div>
      <div class="collapse-content">
        <ul class="w-full space-y-1" role="list">
          @for (segment of segments; track segment.id) {
          <li>
            <label
              class="flex items-center gap-2 px-2 py-2 hover:bg-base-200/50 rounded-md cursor-pointer"
            >
              <input
                type="checkbox"
                class="checkbox checkbox-primary checkbox-sm checkbox-subtle"
                [checked]="isSegmentSelected(segment.name)"
                (change)="selectSegment(segment.name)"
              />
              <span class="text-sm text-base-content">{{ segment.label }}</span>
            </label>
          </li>
          }
        </ul>
      </div>
    </div>

    <!-- Sous-accordéon des filtres par genre -->
    <div class="collapse collapse-arrow mb-4 rounded-lg ml-4">
      <input
        type="checkbox"
        class="collapse-toggle"
        [checked]="genreAccordionOpen()"
        (change)="toggleGenreAccordion()"
      />
      <div
        class="collapse-title hover:bg-base-200 rounded-lg cursor-pointer py-2"
      >
        <h3 class="text-md font-medium">
          Genres @if (getSelectedGenreCount() > 0) {
          <span class="badge badge-secondary badge-sm">{{
            getSelectedGenreCount()
          }}</span>
          }
        </h3>
      </div>
      <div class="collapse-content">
        <div class="max-h-64 overflow-y-auto">
          <ul class="w-full space-y-1" role="list">
            @for (genre of availableGenres; track genre.id) {
            <li>
              <label
                class="flex items-center justify-between px-2 py-1.5 hover:bg-base-200/50 rounded-md cursor-pointer"
              >
                <div class="flex items-center gap-3">
                  <input
                    type="checkbox"
                    class="checkbox checkbox-secondary checkbox-sm checkbox-subtle"
                    [checked]="isGenreSelected(genre)"
                    (change)="selectGenre(genre)"
                  />
                  <span class="text-sm text-base-content">{{
                    genre.name
                  }}</span>
                </div>
                @if (getGenreCount(genre) > 0) {
                <span class="text-xs text-base-content/60"
                  >({{ getGenreCount(genre) }})</span
                >
                }
              </label>
            </li>
            }
          </ul>
        </div>
      </div>
    </div>

    <!-- Compteur d'événements -->
    @if (totalCount > 0 && !loading) {
    <div
      class="mt-3 text-xs text-base-content/70 px-3 bg-base-100 rounded-lg p-3 ml-4 max-w-full overflow-hidden"
    >
      {{ totalCount }} événement{{ totalCount > 1 ? "s" : "" }} trouvé{{
        totalCount > 1 ? "s" : ""
      }}
    </div>
    }
  </div>
</div>
